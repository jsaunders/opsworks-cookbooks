<VirtualHost *:80>

    ErrorLog /var/log/apache2/error.log
    CustomLog /var/log/apache2/access.log combined

    Alias /static/ <%= @project_path %>/static/

    <Directory <%= @project_path %>/static/>
        Order deny,allow
        Require all granted
    </Directory>

    <Directory <%= @project_path %>/<%= @project_name %>>
        <Files wsgi.py>
            Order deny,allow
            Require all granted
        </Files>
    </Directory>

    <Location />

    <% if @force_https -%>
        RewriteEngine On
        RewriteCond %{HTTP:X-Forwarded-Proto} !https [NC]
        RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
    <% end -%>

    <% if @htpasswd -%>
        AuthType Basic
        AuthName "Authentication Required"
        AuthUserFile "/etc/apache2/.htpasswd"
        Require valid-user
    <% end -%>

    </Location>

    <% @environment.each do |key, value| -%>
    SetEnv <%= key %> <%= value %>
    <% end %>

    WSGIDaemonProcess <%= @project_name %> processes=2 threads=15 display-name=%{GROUP} python-path=<%= @project_path %>
    WSGIProcessGroup <%= @project_name %>
    WSGIScriptAlias / <%= @project_path %>/<%= @project_name %>/wsgi.py

</VirtualHost>